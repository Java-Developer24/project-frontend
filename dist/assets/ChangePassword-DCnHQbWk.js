import{A as q,r as n,b as B,j as e,L as i,B as F,_ as u,c as T}from"./index-DAkEzVty.js";import{u as x,p as N,c as R}from"./validators-DibjgpzM.js";import{C as Y,a as D,b as $,c as z}from"./Card-ChcJ8QrX.js";import{I as m}from"./Input-CSgOxdAe.js";import{u as M,E as p,a as h,_ as O}from"./index-BZ92oaWA.js";const G=()=>{const[w,v]=n.useState(!1),[f,P]=n.useState(!1),[g,A]=n.useState(!1),[d,S]=n.useState(""),[j,b]=n.useState(!1);n.useRef(null);const l=M(),a=x("",N),r=x("",N),o=x("",s=>R(s,r.value)),{user:c}=n.useContext(B);console.log(c.userId);const k=localStorage.getItem("paidsms-token"),V=()=>v(s=>!s),I=()=>P(s=>!s),E=()=>A(s=>!s),H=async s=>{if(s.preventDefault(),!d){u.error("Please complete the CAPTCHA");return}if(a.value===r.value){u.error("New password cannot be the same as the current password");return}b(!0),console.log(c);const L=async()=>{try{const t=await T.post("/api/user/change-password",{currentPassword:a.value,newPassword:r.value,userId:c.userId,captcha:d},{headers:{Authorization:`Bearer ${k}`,"Content-Type":"application/json"}});return console.log(t.data),t.data}catch(t){throw t}finally{b(!1)}};await u.promise(L(),{loading:"Changing password...",success:t=>(console.log("Success Data:",t),a.clear(),r.clear(),o.clear(),l.reset(),t.message||"Password changed successfully!"),error:t=>{var y,C;const _=((C=(y=t.response)==null?void 0:y.data)==null?void 0:C.message)||"Failed to change password. Please try again.";return l&&l.reset(),_}})};return e.jsx("div",{className:"h-[calc(100dvh-4rem)] flex flex-col items-center justify-center",children:e.jsxs(Y,{className:"bg-[#121315] w-full max-w-md p-4 rounded-lg border-none dark",children:[e.jsx(D,{children:e.jsx($,{className:"text-center font-medium",children:"Change Your Password"})}),e.jsx(z,{className:"p-0 md:p-6 !pt-0",children:e.jsxs("form",{onSubmit:H,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"current-password",className:"block text-sm text-[#9d9d9d] font-normal py-1",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{id:"current-password",type:g?"text":"password",placeholder:"Enter your current password",className:"w-full h-12 pl-3 pr-10 rounded-lg text-[#9d9d9d] placeholder-text-[#9d9d9d] bg-transparent border-[#e0effe] focus:border-none",value:a.value,onChange:a.changeHandler,required:!0}),e.jsx("button",{type:"button",onClick:E,className:"absolute inset-y-0 right-0 px-3 flex items-center",children:g?e.jsx(p,{className:"w-5 h-5 text-[#9d9d9d]"}):e.jsx(h,{className:"w-5 h-5 text-[#9d9d9d]"})})]}),a.error&&e.jsx("span",{className:"text-red-500 text-xs",children:a.error})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"password",className:"block text-sm text-[#9d9d9d] font-normal py-1",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{id:"password",type:w?"text":"password",placeholder:"Enter your new password",className:"w-full h-12 pl-3 pr-10 rounded-lg text-[#9d9d9d] placeholder-text-[#9d9d9d] bg-transparent border-[#e0effe] focus:border-none",value:r.value,onChange:r.changeHandler,required:!0}),e.jsx("button",{type:"button",onClick:V,className:"absolute inset-y-0 right-0 px-3 flex items-center",children:w?e.jsx(p,{className:"w-5 h-5 text-[#9d9d9d]"}):e.jsx(h,{className:"w-5 h-5 text-[#9d9d9d]"})})]}),r.error&&e.jsx("span",{className:"text-red-500 text-xs",children:r.error})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"confirm-password",className:"block text-sm text-[#9d9d9d] font-normal py-1",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{id:"confirm-password",type:f?"text":"password",placeholder:"Confirm your new password",className:"w-full h-12 pl-3 pr-10 rounded-lg text-[#9d9d9d] placeholder-text-[#9d9d9d] bg-transparent border-[#e0effe] focus:border-none",value:o.value,onChange:o.changeHandler,required:!0}),e.jsx("button",{type:"button",onClick:I,className:"absolute inset-y-0 right-0 px-3 flex items-center",children:f?e.jsx(p,{className:"w-5 h-5 text-[#9d9d9d]"}):e.jsx(h,{className:"w-5 h-5 text-[#9d9d9d]"})})]}),o.error&&e.jsx("span",{className:"text-red-500 text-xs",children:o.error})]})]}),e.jsx("div",{className:"flex justify-center mb-4 mt-8",children:e.jsx(O,{sitekey:"0x4AAAAAAA1Y9hSf6wBjYC09",onVerify:s=>{S(s)}})}),e.jsx(F,{type:"submit",variant:"login",isLoading:j,className:"w-full text-sm font-normal mb-4",disabled:!d||d&&j||!a.value||!r.value||!o.value||a.error||r.error||o.error,children:"Change Password"})]})})]})})},X=q()(G);export{X as default};
