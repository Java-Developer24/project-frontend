import{A as W,r as i,b as z,j as s,S as K,B as j,I as H,R as J,c as p,_ as d}from"./index-HHD5J08U.js";import{P as Q}from"./PopoverComponent-BlY8peS9.js";const U=()=>{const[m,g]=i.useState([]),[R,b]=i.useState([]),[P,v]=i.useState(!0),{user:x,apiKey:f,fetchBalance:y}=i.useContext(z),[E,w]=i.useState({}),[N,S]=i.useState(!1),[_,T]=i.useState({}),[B,$]=i.useState({}),[L,C]=i.useState({}),A=async()=>{try{const[e,t]=await Promise.all([p.get(`/api/user/admin-api/get-orders-data/orders?userId=${x.userId}`),p.get(`/api/history/transaction-history-user?userId=${x.userId}`)]);console.log("Fetched Transactions:",t.data),g(e.data),b(t.data),v(!1)}catch(e){console.error("Error fetching data",e),v(!1)}};i.useEffect(()=>{x&&A()},[x]);const I=e=>{const t=R.filter(n=>n.Id===e);if(t.length===0)return["Waiting for SMS"];const r=t.map(n=>n.otp).filter(n=>n!==null);return r.length>0?r:["Waiting for SMS"]},O=e=>{const t=new Date,r=new Date(e)-t;if(r<=0)return"00:00";const n=Math.floor(r/6e4),a=Math.floor(r%6e4/1e3);return`${n<10?"0":""}${n}:${a<10?"0":""}${a}`},k=({expirationTime:e,orderId:t})=>{const[r,n]=i.useState(()=>O(e));return i.useEffect(()=>{const a=()=>{const l=O(e);n(h=>h!==l?(l==="00:00"?(w(u=>({...u,[t]:!0})),M(t)):l.split(":")[0]<="17"&&w(u=>({...u,[t]:!0})),l):h)};a();const c=setInterval(a,1e3);return()=>clearInterval(c)},[e,t]),s.jsx("span",{className:"font-mono",children:r})},M=async e=>{g(t=>t.filter(r=>r._id!==e)),await y(f)},q=async(e,t,r,n)=>{T(a=>({...a,[e]:!0}));try{await p.get(`/api/service/number-cancel?api_key=${f}&Id=${t}`),g(a=>a.filter(c=>c._id!==e)),await y(f),d.success(n?"Order finished successfully!":"Number cancelled successfully!")}catch(a){a.response?d.error(a.response.data.status||a.response.data.message):a.request?d.error("No response received from the server. Please try again."):d.error(`An unexpected error occurred: ${a.message}`)}finally{T(a=>({...a,[e]:!1}))}},F=async(e,t,r,n)=>{const a=t.toLowerCase().replace(/\s+/g,"").replace(/[^a-z0-9]/g,"");$(l=>({...l,[r]:!0}));const c=new Promise((l,h)=>{(async()=>{try{await p.get(`/api/service/get-number?api_key=${f}&code=${a}&server=${e}`),await A(),l()}catch(o){o.response?d.error(o.response.data.message):o.request?d.error("No response received from the server. Please try again."):d.error(`An unexpected error occurred: ${o.message}`)}finally{y(f),$(o=>({...o,[r]:!1}))}})()});await d.promise(c,{loading:"Buying Again...",success:()=>"Number bought again successfully!",error:l=>{var u,o;return console.error("Error buying the number again",l),((o=(u=l.response)==null?void 0:u.data)==null?void 0:o.error)||"Please try again."}})},D=async e=>{try{const t=[];for(const n of e){const{Id:a}=n,c=await p.get(`/api/service/get-otp?api_key=${f}&Id=${a}`);c.data&&c.data.length>0&&t.push(...c.data)}const r=await p.get(`/api/history/transaction-history-user?userId=${x.userId}`);b(r.data),S(!1)}catch(t){console.error("Error fetching OTP",t),S(!0)}};i.useEffect(()=>{let e;return N||(e=setInterval(()=>{D(m)},5e3)),console.log(m),()=>clearInterval(e)},[m,N]);const G=(e,t)=>{C(r=>({...r,[t]:!0})),navigator.clipboard.writeText(e)};return s.jsx("div",{className:"h-[calc(100dvh-4rem)] overflow-y-auto hide-scrollbar",children:P?s.jsx("div",{className:"w-full flex h-full justify-center items-center",children:s.jsx(K,{})}):m.length===0?s.jsx("div",{className:"h-[calc(100dvh-4rem)]  flex items-center justify-center relative",children:s.jsxs("h1",{className:"text-[28px] lg:text-[55px] leading-[30px] lg:leading-[55px] font-[600] lg:font-[500] text-center absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:[s.jsx("span",{className:"text-primary",children:"No"})," Active Orders"]})}):m.map(e=>{const t=I(e.Id).some(r=>r!=="Waiting for SMS");return s.jsx("div",{className:"w-full flex justify-center my-12",children:s.jsxs("div",{className:"w-full max-w-[520px] flex flex-col items-center border-2 border-[#1b1d21] bg-[#121315] rounded-2xl p-5",children:[s.jsxs("div",{className:"w-full flex flex-col items-center px-4 mb-4 text-sm font-normal gap-y-2",children:[s.jsxs("div",{className:"w-full flex text-center items-center justify-between",children:[s.jsx("p",{children:"Service:"}),s.jsxs("span",{children:[" ",e.service]})]}),s.jsx("hr",{className:"border-[#888888] border w-full"}),s.jsxs("div",{className:"w-full flex text-center items-center justify-between",children:[s.jsx("p",{children:"Server:"}),s.jsxs("span",{children:[" ",e.server]})]}),s.jsx("hr",{className:"border-[#888888] border w-full"}),s.jsxs("div",{className:"w-full flex text-center items-center justify-between",children:[s.jsx("p",{children:"Price:"}),s.jsxs("span",{children:[" ₹",e.price]})]}),s.jsx("hr",{className:"border-[#888888] border w-full"}),s.jsxs("div",{className:"w-full flex text-center items-center justify-between",children:[s.jsx("p",{children:"Otp type:"}),s.jsx("span",{children:e.otpType.split(" ")[0]})]})]}),s.jsx("div",{className:"w-full flex border rounded-2xl items-center justify-center h-[45px]",children:s.jsxs("p",{className:"py-4 px-5 flex w-full gap-4 items-center justify-center rounded-lg text-xl font-medium",children:[s.jsxs("span",{children:["+91 ",e.number]}),s.jsx(Q,{buttonComponent:s.jsx(j,{variant:"link",className:"p-0 h-0",onClick:()=>G(e.number,e._id),children:s.jsx(H.copy,{className:"w-4 h-4"})}),popoverContent:"Copied!",open:L[e._id]||!1,setOpen:r=>C(n=>({...n,[e._id]:r}))})]})}),s.jsx("div",{className:"w-full flex rounded-2xl items-center justify-center h-[60px]",children:s.jsxs("div",{className:"bg-transparent max-w-56 py-4 px-5 flex w-full items-center justify-between rounded-lg",children:[s.jsx("p",{className:"font-normal",children:"Remaining Time"}),s.jsx(k,{expirationTime:e.expirationTime,orderId:e._id})]})}),s.jsx("div",{className:"w-full flex bg-[#444444] border-2 border-[#888888] rounded-2xl items-center justify-center max-h-[100px] overflow-y-scroll hide-scrollbar",children:s.jsx("div",{className:"w-full h-full flex flex-col items-center",children:I(e.Id).map((r,n,a)=>s.jsxs(J.Fragment,{children:[s.jsx("div",{className:"bg-transparent py-4 px-5 flex w-full items-center justify-center",children:s.jsx("h3",{className:"font-normal text-sm",children:r})}),n<a.length-1&&s.jsx("hr",{className:"border-[#888888] border w-full"})]},n))})}),s.jsx("div",{className:"w-full flex rounded-2xl items-center justify-center mb-2",children:s.jsxs("div",{className:"bg-transparent pt-4 flex w-full items-center justify-center gap-4",children:[s.jsx(j,{className:"py-2 px-9 rounded-full border-2 border-primary font-normal bg-primary text-white hover:bg-teal-600 transition-colors duration-200 ease-in-out",onClick:()=>q(e._id,e.Id,e.server,t),isLoading:_[e._id],disabled:_[e._id]||!E[e._id]&&!t,children:t?"Finish":"Cancel"}),s.jsx(j,{className:"py-2 px-6 rounded-full border-2 border-primary font-normal bg-transparent text-primary hover:bg-primary hover:text-white transition-colors duration-200 ease-in-out",onClick:()=>F(e.server,e.service,e._id,e.otpType),isLoading:B[e._id],children:"Buy Again"})]})})]})},e._id)})})},Y=W()(U);export{Y as default};
