import{r as o,j as e,A as te,u as re,a as ae,_ as t,b as ne,L as j,B as p,I as oe,c as b}from"./index-HHD5J08U.js";import{C as le,a as de,b as ie,c as ce}from"./Card-C-TH2qUE.js";import{I as w}from"./Input-D-HkuPgb.js";import{u as ue,E as T,a as F,_ as me}from"./index-yb2eVccj.js";import{u as N,e as U,p as pe,c as fe}from"./validators-Dj3Zy3hJ.js";let P=0;const he=({length:h=6,otp:L,onOtpChange:C})=>{const[y,S]=o.useState(new Array(h).fill("")),[x,i]=o.useState(0),c=o.useRef(null),O=({target:l})=>{const{value:n}=l,d=[...y];d[P]=n.substring(n.length-1),i(n?P+1:P-1),S(d);const v=d.join("");C(v)},E=({key:l},n)=>{P=n,l==="Backspace"&&i(P-1)};return o.useEffect(()=>{var l;(l=c.current)==null||l.focus()},[x]),e.jsx("div",{className:"flex items-center space-x-2 w-fit",children:y.map((l,n)=>e.jsx(o.Fragment,{children:e.jsx(w,{ref:n===x?c:null,onChange:O,onKeyDown:d=>E(d,n),className:"w-10 text-center bg-transparent no-arrows",type:"number",value:y[n]})},n))})},xe=()=>{ue();const[h,L]=o.useState(!1),[C,y]=o.useState(""),[S,x]=o.useState(!1),i=N("",U),c=N("",U),[O,E]=o.useState(!1),[l,n]=o.useState(!1),d=N(""),v=re(),[I,R]=o.useState(!1),[q,G]=o.useState(""),[V,$]=o.useState(!1),[A,B]=o.useState(60),[K,D]=o.useState(!1),H=ae();o.useEffect(()=>{const a=new URLSearchParams(H.search).get("error");a&&t.error(a)},[H.search]);const m=N("",pe),g=N("",r=>fe(r,m.value)),M=()=>v("/signup"),{login:Y}=o.useContext(ne),_=()=>{L(r=>!r)},z=()=>E(r=>!r),J=r=>{G(r)};o.useEffect(()=>{if(A>0){const r=setInterval(()=>{B(a=>a-1)},1e3);return()=>clearInterval(r)}else $(!0)},[A]);const Q=async r=>{if(r.preventDefault(),q.length!==6){t.error("Please enter a valid 6-digit OTP");return}n(!0);const a=new Promise((s,u)=>{(async()=>{try{const f=await b.post("/api/user/verify-forgot-otp",{email:c.value,otp:q});s(f)}catch(f){u(f)}finally{n(!1)}})()});await t.promise(a,{loading:"Verifying otp...",success:s=>{var u;return R(!1),x(!0),(u=s.data)==null?void 0:u.message},error:s=>{s.response?t.error(s.response.data.message):s.request?t.error("No response received from the server. Please try again."):t.error(`An unexpected error occurred: ${s.message}`)}})},W=async()=>{$(!1),B(60);const r=new Promise((a,s)=>{(async()=>{try{await b.post("/api/user/resend-forgot-otp",{email:c.value}),a()}catch(k){s(k)}})()});await t.promise(r,{loading:"Resending otp...",success:()=>"OTP resent successfully",error:a=>{a.response?t.error(a.response.data.message):a.request?t.error("No response received from the server. Please try again."):t.error(`An unexpected error occurred: ${a.message}`)}})},X=async r=>{r.preventDefault(),n(!0);const a=new Promise((s,u)=>{(async()=>{try{await b.post("/api/user/forgot-password",{email:c.value}),s()}catch(f){u(f)}finally{n(!1)}})()});await t.promise(a,{loading:"Sending otp...",success:()=>(D(!0),R(!0),"OTP sent to your email"),error:s=>{t.dismiss(),s.response?t.error(s.response.data.message):s.request?t.error("No response received from server"):t.error(`Error: ${s.message}`),t.error(errorMessage)}})},Z=async r=>{r.preventDefault(),n(!0);const a=new Promise((s,u)=>{(async()=>{try{await b.post("/api/user/change-password-unauthenticated",{email:c.value,newPassword:m.value}),s()}catch(f){u(f)}finally{n(!1)}})()});await t.promise(a,{loading:"Processing request...",success:()=>(x(!1),D(!1),R(!1),"Password changed successfully. Please log in."),error:s=>{s.response?t.error(s.response.data.message):s.request?t.error("No response received from the server. Please try again."):t.error(`An unexpected error occurred: ${s.message}`)}})},ee=async r=>{if(r.preventDefault(),!(i!=null&&i.value)||!(d!=null&&d.value)||!C){t.error("Please fill out all fields and complete the CAPTCHA");return}n(!0);const a=t.loading("Logging in...");try{const{data:s}=await b.post("/api/auth/login",{email:i.value,password:d.value,captcha:C}),{token:u}=s;Y(u),t.dismiss(a),setTimeout(()=>{v("/"),t.success("Login successful!",{duration:3e3})},2e3)}catch(s){t.dismiss(a),s.response?t.error(s.response.data.message):s.request?t.error("No response received from the server. Please try again."):t.error(`An unexpected error occurred: ${s.message}`)}finally{n(!1)}},se=async()=>{var r,a;try{window.location.href="https://backendapi.tech-developer.online/api/auth/google/login"}catch(s){v(`/login?error=${encodeURIComponent(((a=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:a.message)||"Login failed. Please try again.")}`)}};return e.jsx("div",{className:"h-[calc(100dvh-4rem)] flex items-center justify-center",children:e.jsxs(le,{className:"bg-[#121315] w-full max-w-md rounded-lg border-none dark",children:[e.jsx(de,{children:e.jsx(ie,{className:"text-center font-medium",children:S?I?"Verify OTP":"Reset Password":"Login"})}),e.jsx(ce,{className:"p-4 md:p-6 !pt-0",children:S?K?I?e.jsx("form",{onSubmit:Q,children:e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-col sm:flex-row",children:[e.jsx(he,{length:6,otp:q,onOtpChange:J}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(p,{variant:"link",className:"text-sm font-normal text-[#397CFF] !no-underline p-1 h-0 mt-2",onClick:W,disabled:!V,children:["Resend OTP ",V?"":`(${A}s)`]})}),e.jsx(p,{type:"submit",className:"w-full bg-primary text-white font-medium py-2 rounded-lg my-4 h-10",disabled:q.length!==6||l,isLoading:l,children:"Verify OTP"})]})}):e.jsxs("form",{onSubmit:Z,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"new-password",className:"block text-sm text-[#9d9d9d] font-normal py-1",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{id:"new-password",type:h?"text":"password",placeholder:"Enter your new password",className:"w-full h-10 pl-3 pr-10 rounded-lg text-[#9d9d9d] placeholder-text-[#9d9d9d] bg-transparent border-[#e0effe] focus:border-none",value:m.value,onChange:m.changeHandler,required:!0}),e.jsx("button",{type:"button",onClick:_,className:"absolute inset-y-0 right-0 px-3 flex items-center",children:h?e.jsx(T,{className:"w-5 h-5 text-[#9d9d9d]"}):e.jsx(F,{className:"w-5 h-5 text-[#9d9d9d]"})})]}),m.error&&e.jsx("span",{className:"text-red-500 text-xs",children:m.error})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"confirm-password",className:"block text-sm text-[#9d9d9d] font-normal py-1",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{id:"confirm-password",type:O?"text":"password",placeholder:"Confirm your new password",className:"w-full h-10 pl-3 pr-10 rounded-lg text-[#9d9d9d] placeholder-text-[#9d9d9d] bg-transparent border-[#e0effe] focus:border-none",value:g.value,onChange:g.changeHandler,required:!0}),e.jsx("button",{type:"button",onClick:z,className:"absolute inset-y-0 right-0 px-3 flex items-center",children:O?e.jsx(T,{className:"w-5 h-5 text-[#9d9d9d]"}):e.jsx(F,{className:"w-5 h-5 text-[#9d9d9d]"})})]}),g.error&&e.jsx("span",{className:"text-red-500 text-xs",children:g.error})]})]}),e.jsx(p,{type:"submit",className:"w-full bg-primary text-white font-medium py-2 rounded-lg mt-3 h-10",disabled:!m.value||!g.value||m.error||g.error||l,isLoading:l,children:"Change Password"})]}):e.jsxs("form",{onSubmit:X,children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(j,{htmlFor:"email",className:"block text-sm text-[#9d9d9d] font-normal py-1",children:"Email"}),e.jsx(w,{id:"email",type:"email",placeholder:"m@example.com",className:"w-full h-10 pl-3 rounded-lg text-[#9d9d9d] placeholder-text-[#9d9d9d] bg-transparent border-[#e0effe] focus:border-none",value:c.value,onChange:c.changeHandler,required:!0}),c.error&&e.jsx("span",{className:"text-red-500 text-xs",children:c.error})]})}),e.jsx(p,{type:"submit",className:"w-full bg-primary text-white font-medium py-2 rounded-lg mt-3 h-10",isLoading:l,disabled:c.error||l||!c.value,children:"Send OTP"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:ee,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"email",className:"block text-sm text-[#9d9d9d] font-normal py-1",children:"Email"}),e.jsx(w,{id:"email",type:"email",placeholder:"m@example.com",className:"w-full h-10 pl-3 rounded-lg text-[#9d9d9d] placeholder-text-[#9d9d9d] bg-transparent border-[#e0effe] focus:border-none",value:i.value,onChange:i.changeHandler,required:!0}),i.error&&e.jsx("span",{className:"text-red-500 text-xs",children:i.error})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"password",className:"block text-sm text-[#9d9d9d] font-normal py-1",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{id:"password",type:h?"text":"password",placeholder:"Enter your password",className:"w-full h-10 pl-3 pr-10 rounded-lg text-[#9d9d9d] placeholder-text-[#9d9d9d] bg-transparent border-[#e0effe] focus:border-none",value:d.value,onChange:d.changeHandler,required:!0}),e.jsx("button",{type:"button",onClick:_,className:"absolute inset-y-0 right-0 px-3 flex items-center",children:h?e.jsx(T,{className:"w-5 h-5 text-[#9d9d9d]"}):e.jsx(F,{className:"w-5 h-5 text-[#9d9d9d]"})})]}),d.error&&e.jsx("span",{className:"text-red-500 text-xs",children:d.error})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(p,{variant:"link",className:"text-sm font-normal text-[#397CFF] !no-underline p-1 h-0",onClick:()=>x(!0),children:"Forgot password"})})]}),e.jsx("div",{className:"flex justify-center mb-4 mt-8",children:e.jsx(me,{sitekey:"0x4AAAAAAA1Y9hSf6wBjYC09",onVerify:r=>{y(r)},className:"scale-[0.85] md:transform-none"})}),e.jsx(p,{type:"submit",variant:"login",isLoading:l,className:"w-full text-sm font-normal mb-4",disabled:!i.value||!d.value,children:"Login"}),e.jsxs(p,{onClick:se,variant:"outline",type:"button",className:"w-full text-sm",children:[e.jsx(oe.google,{className:"w-4 h-4 mr-2"})," Continue with Google"]})]}),e.jsxs("div",{className:"mt-4 text-center text-sm text-[#BEBEBF] font-normal",children:["Don't have an account?"," ",e.jsx(p,{variant:"link",className:"!no-underline py-0 px-1 text-sm font-normal h-0",onClick:M,children:"Sign Up"})]})]})})]})})},be=te()(xe);export{be as default};
